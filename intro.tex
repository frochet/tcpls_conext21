% !TEX root = ./paper.tex
The Transmission Control Protocol (\tcp) \cite{rfc793} is one of the most critical protocols in today's Internet. A wide range of applications use it for reliable transfers. During the last four decades, \tcp evolved under the pressure of competing protocols. During the 1980s, software-based \tcp implementations were considered too slow. Researchers proposed new transport protocols such as \xtp~\cite{sanders1990xpress} which could be implemented in hardware. Meanwhile, \tcp implementations got a considerable speed boost~\cite{clark1989analysis}, and \xtp disappeared. The \tcp speed boost and usage triggered the development of various important \tcp extensions, including timestamps and large windows~\cite{rfc1323} or Selective Acknowledgments~\cite{rfc2018}.

During the late nineties, early 2000s, transport protocol researchers
explored alternatives to \tcp. Two new transport protocols
were standardized within the IETF: \dccp~\cite{kohler2006designing} and
\sctp~\cite{rfc4960}. We rarely use \dccp today. Despite its benefits
(support for multihoming, better design, and extensibility), only niche
applications use it. This limited deployment is probably due to two different factors. First, \sctp forced the applications to use a new API. Second, the Internet contains various middleboxes (NAT, firewalls, etc.) that often block packets that do not carry \tcp or \udp~\cite{honda2011still}.
\sctp initially supported multihoming by switching from one path to another. It
was later extended to be able to use different paths continuously~\cite{iyengar2006concurrent}.  Multipath \tcp~\cite{rfc6824,raiciu2012hard} brought similar capabilities to \tcp, and included a coupled congestion control scheme~\cite{wischik2011design}, later brought to \sctp as well. This particular
succession of events shows how different designs can collaborate to advance each others.
%Multipath \tcp is now deployed, notably on
%smartphones~\cite{bonaventure2016multipath}. 


%However, there are several limits to \tcp's extensibility. First, the
%entire \tcp header, including options, cannot be longer than
%64 bytes, which leaves a limited space to carry new options, in particular
%inside SYN packets. The IETF tried to circumvent this limitation
%\cite{draft-ietf-tcpm-tcp-edo-10}, but no \tcp stack has adopted it.
%Second, and more importantly, various
%deployed middleboxes make assumptions about the semantics of the \tcp
%packets that they process. Some of these middlebox, e.g. in mobile or
%satellite networks, transparently terminate \tcp connections initiated by
%client devices to optimise their performance. Others, like firewalls, analyse
%the packets exchanged to detect varioustypes of attacks.
%Unfortunately, many of these middleboxes block the \tcp options that they
%do not understand. This is affected the design of recent \tcp extensions like
%Multipath \tcp or Fast Open that has even been disabled by some vendors
%due to operational issues with middleboxes. This problem also
%affects other standardised transport protocols like DCCP \cite{} or
%SCTP \cite{} that already have difficulties to traverse simple middleboxes
%such as NATs.

In the mid-nineties, the Secure Socket Layer (SSL) protocol was proposed to secure
emerging e-commerce websites~\cite{draft-hickman-netscape-ssl}. SSL
evolved in different versions of the Transport Layer Security (\tls) protocol, the most recent one being version 1.3~\cite{rfc8446}. Many details of the \tls protocol have changed since the first version of SSL~\cite{kotzias2018coming}. Nowadays, \tls is almost ubiquitous on web servers~\cite{holz2019era}. Furthermore, many non-web applications also rely on \tls~\cite{anderson2019tls}.

%In parallel, we also observe a growing deployment of \tls. A large fraction of
%the Internet traffic is currently composed of application data secured by \tls
%that is transported by \tcp. \tls brings several benefits from privacy and
%security viewpoints, but does not currently help with the middlebox problem.

\quic started as a proprietary protocol used by Google to speed up web
transfers~\cite{roskind2013quic,langley2017quic}. During the last years, it evolved into a complete transport protocol whose standardization is being finalized within the IETF~\cite{draft-ietf-quic-transport}. \quic combines the
functions that are usually found in \tcp, \tls, and HTTP/2. A key characteristic
of \quic is that it encrypts almost all the packets, including most of their headers. Although \quic is essentially a new transport protocol, it does not run
directly above IP in contrast with \sctp or \tcp. \quic runs above \udp. With this choice, \quic can be implemented as a userspace library and \quic packets can pass through most existing middleboxes. 
%\quic's clean architecture has attracted researchers
%who have already proposed various extensions to the protocol~\cite{de2019pluginizing,viernickel2018multipath,polese2019survey,michel2019quic,draft-huitema-quic-ts,draft-shi-quic-dtp,draft-swett-nwcrg-coding-for-quic}.

Does the standardization of \quic marks the end of the \tcp era and implies that all applications and transport research will move to \quic ? 
We do not think so. History tells us that \tcp has evolved with competing
transport protocols. \quic is today's competitor, but there is still plenty of
room to improve \tcp.

In this paper, we take a step back. As \quic closely couples the reliability and security mechanisms, we reconsider the separation between \tcp and \tls.
%By considering \tcp and
%\tls as independent protocols,  a very important opportunity.
%\tls brings security features, but \tls 1.3 can do much more. Thanks to the \tls 1.3 messages and records' extensibility, \tls can provide a secondary channel that enables hosts to exchange more control information and structured data. Furthermore, since \tls records are encrypted, middleboxes cannot easily interfere with the data exchanged over this new channel.
%In this paper, we combine both \tcp and \tls in a single protocol called \textbf{\tcpls}. We describe in Sec.~\ref{sec:design} a first design for \tcpls with the goals of ($i$) solving extensibility issues in \tcp. ($ii$) Exporting complex transport features to the application and, ($iii$), drawing a path to make \tcp/\tls a good challenger to \quic with modern appications.   This paper also discusses how \tls flexible record layer can be used to provide a new channel to exchange information between \tcpls implementations. The design presentation concludes with an overview of the API to interact with the application.  Our second contribution is the ongoing
%implementation of a \tcpls prototype on Linux by extending \texttt{picotls}, a
%\texttt{TLS 1.3}
%implementation.  We use it in Section~\ref{sec:prototype} to illustrate the
%benefits of \tcpls with a multihoming connection migration use case. Finally, we analyze in Section~\ref{sec:research} some of the research questions that \tcpls opens.
In this paper, we combine both \tcp and \tls 1.3 in a single fast, flexible, and secure protocol called \textbf{\tcpls}\footnote{A preliminary version of this work was presented in a workshop paper~\cite{rochet2020tcpls}.}. We have designed \tcpls with three goals in mind. First, \tcpls exposes modern transport features, such as multipath capabilities, to the application. Second, \tcpls solves \tcp's extensibility issues in \tcp by relying on the \tls handshake for \tcp options negociation and by including \tcp options inside \tls records. 
Finally, we draw a path to make \tcpls a good challenger to \quic.
With that in mind, we have implemented \tcpls as a user space library that exposes a powerful API to applications but still relies on the high-performance in-kernel \tcp stack. Our implementation uses \tls' flexible record layer to create a secure control channel that the endpoints of a \tcpls session can use to exchange control information. This channel enables different use cases such as connection migration or seamless failovers without risking middlebox interference. Our lab measurements indicate that our \tcpls prototype outperforms existing \quic implementations in terms of pure performance, while allowing more flexibility with respect to recovery and connection migration. Our \tcpls has been thought with open access in mind and will be released upon this paper acceptance.

The remainder of this paper is organized as follows: Sec.~\ref{sec:background} provides the required technical background; Sec.~\ref{sec:background-design} discusses how we designed \tcpls, while Sec.~\ref{sec:prototype} focuses on how we implemented \tcpls; Sec.~\ref{sec:evaluation} evaluates the performance and behavior of \tcpls;  finally, Sec.~\ref{sec:conclusion} concludes this paper by summarizing its main achievements and discussing further directions.
This work does not raise any ethical issues.

% Extending \tls's philosophy of protecting the transport layer (only Integrity,
% confidentiality and Authentication); now would also improve other issues of
% the transport layer.

%middlebox interferences

%The beneÔ¨Åt of upgrading an individual endpoint depends on the number of other
%endpoints that have already been upgraded,since the new protocol is not
%effective unless both have it

% Talk about the backward-compatible nightmare when the security is at stake

% \tls offers an opportunity to fix part of \tcp's issues, offering a right
% abstraction of what a transport layer means for a given application.
